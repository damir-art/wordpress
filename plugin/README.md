# Создание плагинов
Создание плагинов в WordPress.  
Шпаргалка по плагинам: https://wp-kama.ru/handbook/cheatsheet  
Все хуки и функции плагина: https://wp-kama.ru/function-cat/plugins  
Плагины хранятся по адресу: `site/wp-content/plugins`

Плагин это:
- инкапсулированный законченный скрипт, расширяющий функционал сайта, без изменения кода ядра
- не зависит от темы (в отличии от кода в functions.php)
- реализуется с помощью хуков
- плагин можно поместить в 1 файл или целую структуру с папками и файлами
- имя плагина должно быть уникальным (рекомендуется), см репозиторий WordPress
- имя плагина также должно быть префиксом функций внутри плагина
- плагин может состоять из файлов: `.php`, `.css`, `.js`

## Создаём плагин banner
Создадим благин с именем `banner`.
- создадим в `site/wp-content/plugins` папку `banner`
- внутри папки `banner` создаём файл `index.php` (чтобы нельзя было просматривать файлы каталога)
  - в начале файла помещаем код `<?php`
- внутри папки `banner` создаём главный файл плагина `banner.php` (рекомендуется файл называть как имя папки)
  - в начале файла помещаем код `<?php` и комментарии (заголовки) плагина
  - заголовки плагина могут состоять из одно строки, имени плагина
  - `/**`
  - `* Plugin Name: Баннер для сайта`
  - `*/`
  - подробнее обо всех заголовках ниже
- после добавления заголовков, можно зайти в админку и активировать плагин

Стандартные заголовки:

    /**
     * Plugin Name: Баннер для сайта
     * Plugin URI: https://damir-art.ru
     * Description: Описание баннера для сайта
     * Version: 1.0
     * Author: Damir
     * Author URI: https://damir-art.ru
     */

Список основных заголовков:

    /**
    * Plugin Name: Название плагина (отображается в списк плагинов)
    * Description: Описание плагина желательно не более 140 символов
    * Plugin URI:  Ссылка на страницу плагина
    * Author URI:  Ссылка на автора
    * Author:      Имя автора
    * Version:     Версия плагина, например 1.0
    *
    * Text Domain: ID перевода, указывается в load_plugin_textdomain()
    * Domain Path: Путь до файла перевода (относительно папки плагина)
    * Requires at least: 2.5 (самая низкая версия WordPress при которой работает плагин)
    * Requires PHP: 5.4 (минимальная версия PHP)
    *
    * License:     GPL2 (короткое имя лицензии)
    * License URI: https://www.gnu.org/licenses/gpl-2.0.html
    *
    * Network:     Укажите "true" для возможности активировать плагин для сети Multisite.
    * Update URI: https://example.com/link_to_update
    */

    // код плагина

## Основные хуки плагина
- `register_activation_hook()` - регистрирует функцию, которая будет срабатывать во время активации плагина (используется для добавления настроек плагина и т.п.)
- `register_deactivation_hook()` - регистрирует функцию, которая должна запускаться после деактивации плагина (используется для удаления временных данных плагина)
- `register_uninstall_hook()` - регистрирует функцию, которая вызывается при удалении плагина (используется для удаления всех данных плагина: в настройках, в файлах, в базе данных и т.д.)

## Функции WordPress
Функции WordPress API используемые при создании плагинов:

- `API настроек` (https://wp-kama.ru/id_3773/api-optsiy-nastroek.html) - упрощает создание и управление опциями плагина, которые сохраняются в базу данных.
- `plugin_dir_url()` - получает URL папки (директории, каталога), где находится указанный файл плагина (со слэшем на конце)
- `HTTP API` (https://wp-kama.ru/id_6462/wordpress-http-api.html) - упрощает создание HTTP запросов в PHP (заменяет cURL)

## Безопасность
К нашему файлу можно обратиться по адресу `site/wp-content/plugins/banner/banner.php`, чтобы этого не происходило нужно создать проверку на прямое обращение в обход ядра:

    // Проверяем на прямой доступ к файлу
    if ( !function_exists( 'add_action' ) ) {
      echo 'Прямой доступ к файлу, запрещён!';
      exit;
    }

Если происходит прямое обращение к файлу в обход ядра, то функции и константы ядра не объявлены.

## Создаём свои константы плагина

    // Определяем свои константы
    define( 'BANNER_PLUGIN_DIR', plugin_dir_path( __FILE__ ) ); // путь к корневой папки плагина
    define( 'BANNER_PLUGIN_URL', plugin_dir_url( __FILE__ ) ); // путь к корневой папки плагина по URL
    define( 'BANNER_PLUGIN_NAME', dirname( plugin_basename( __FILE__ ) ) ); // для переводов, название папки плагина

    // var_dump( BANNER_PLUGIN_DIR, BANNER_PLUGIN_URL, BANNER_PLUGIN_NAME ); // см. исходный код на главной

## Подключаем класс активации плагина

    // Подключаем класс активации плагина
    function banner_activate() {
      require_once BANNER_PLUGIN_DIR . 'includes/class-banner-activate.php';
    }
    register_activation_hook( __FILE__, 'banner_activate' );

## Разное
Вместо плагина можно использовать файл functions.php, даже написать большой плагин подключая его файлы.

Грамотно созданный плагин не нагружает систему, поэтому их можно ставить много. Просто своим присутствием плагины не влияют на скорость работы сайта (даже активные).
